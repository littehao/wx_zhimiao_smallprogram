{"version":3,"sources":["uni-app:///main.js","webpack:////Users/huhao/Desktop/www/wx_zhimiao/pagesB/chat/chat.vue?d1d7","webpack:////Users/huhao/Desktop/www/wx_zhimiao/pagesB/chat/chat.vue?7fde","webpack:////Users/huhao/Desktop/www/wx_zhimiao/pagesB/chat/chat.vue?d67c","webpack:////Users/huhao/Desktop/www/wx_zhimiao/pagesB/chat/chat.vue?1234","uni-app:///pagesB/chat/chat.vue","webpack:////Users/huhao/Desktop/www/wx_zhimiao/pagesB/chat/chat.vue?e974","webpack:////Users/huhao/Desktop/www/wx_zhimiao/pagesB/chat/chat.vue?56ba"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","components","messageInput","messageList","data","emojiShow","conversation","conversationID","sendMsgId","demandId","userId","toName","demandData","businessStatus","conversationalistUserRolel","applyOrderDisabled","changeDemandModal","imSingleChatSessionId","olddemandRegistrationId","newdemandRegistrationId","newimSingleChatSessionId","newdemandTitle","computed","onLoad","console","userID","options","uni","watch","isSDKReady","destroyed","clearTimeout","methods","getDemandDatelsFn","id","undertakingUserId","res","selectByPrimaryKeyFn","changeApplyOrder","getConversationProfileFn","setMessageRead","then","getConversationName","showChat","sendMessage","applyOrder","demandRegistrationId","sendPaymentFn","pay","requestPaymentFn","provider","timeStamp","nonceStr","package","signType","paySign","success","_this","fail","icon","title","queryPaymentFn","replacementRequirementsFn","mescrollInit","scrollFn","downCallback","setTimeout","upCallback","handleClose","emojiShowFn","formatNumber"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,aAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAiH;AACjH;AACwD;AACL;AACc;;;AAGjE;AACgN;AAChN,gBAAgB,iNAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,+EAAM;AACR,EAAE,wFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,mFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,oPAEN;AACP,KAAK;AACL;AACA,aAAa,8LAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACpDA;AAAA;AAAA;AAAA;AAAk0B,CAAgB,kyBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;ACsDt1B;AAIA;AAEA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA,eAGA;EACAC;IACAC;IACAC;EACA;EACAC;IACA;MACAC;MAAA;MACAC;MACAC;MACAC;MAAA;MACAC;MACAC;MACAC;MACAC;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MACAC;MAAA;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EACAC,4BACA,2DACA;EACA;AACA;AACA;EACAC;IACA;IACA;IACAC;IACA,IACAC,SACAC,QADAD;IAEA;IACA;IACA;IACA;IACAD;IACAA;IACAA;IACA;MAAA;MACA;MACA;MACA;MACA;MACAG;MACAA;MACAA;MACAA;MACA;IACA;IACA;IACA;IACA;IACA;EACA;EACAC;IACAC;MAAA;MACA;QACAL;QACA;MACA;IACA;EACA;EACAM;IACAC;IACA;EACA;EACAC,yCACA,wGACA,sFACA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAEA;kBACAC;kBACAC;gBACA;cAAA;gBAHAC;gBAIA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAEA;kBACA3B;gBACA;cAAA;gBAFA0B;gBAGA;kBACA;kBACA;kBACA;kBACA;kBACA;oBACA;kBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEA;gBACAZ;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACAc;MAAA;MACA;IACA;IACAC;MAAA;MAAA;MACAf;MACAG,YACAa;QACAjC;MACA,GACAkC;QACAjB;MACA;QACAA;MACA;MACAA;MACAG;QACA,IACArB,eACA8B,SADA9B;QAEAkB;QACA;QACA;QACA;MACA;QACAA;MACA;IACA;IACAkB;MAAA;MACA;QACA;UACAC;QACA;QACA;MACA;MAEA;QACA;MACA;IACA;IACAC;MACA;MACA;IACA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,MACA;kBAAA;kBAAA;gBAAA;gBAAA;gBAAA,IAEA;kBAAA;kBAAA;gBAAA;gBACA;gBAAA;cAAA;gBAAA;gBAAA,OAGA;kBACA5B;gBACA;cAAA;gBAFAmB;gBAGA;kBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAZ;gBACA;kBACA;gBACA;kBACA;gBACA;gBACA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA,IAIA;kBAAA;kBAAA;gBAAA;gBACA;gBAAA;cAAA;gBAAA;gBAAA,OAGA;kBACAsB;gBACA;cAAA;gBAFAV;gBAGA;kBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAZ;gBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAIA;IACAuB;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAEA;kBAAAD;gBAAA;cAAA;gBAAAV;gBACAY;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEA;kBACA;kBACA;gBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACAC;MACA;MACAtB;QACAuB;QAAA;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;UACAhC;UACAA;UACAiC;QACA;QACAC;UACAlC;UACAA;UACA;YACAG;cACAgC;cACAC;YACA;UACA;YACAjC;cACAgC;cACAC;YACA;UACA;QACA;MACA;IACA;IACAC;MAAA;MACA;QAAAf;MAAA;QACA;UACAf;UACA;UACAJ;UACAA;YACAgC;YACAC;UACA;UACA;UACA;UACA;QACA;MACA;QACApC;QACA;UACAG;YACAiC;UACA;UACA7B;UACA;YACA;UACA;QACA;UACA;QACA;MACA;IACA;IACA+B;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEA1D;kBACA0C;kBACA7B;gBACA;gBAAA;gBAAA,OACA;cAAA;gBAAAmB;gBACA;kBACA;kBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAZ;gBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACAuC;MACA;IACA;IACAC;MACA;IACA;IACAC;MAAA;MACAC;QACA;MACA;IACA;IACAC;MAAA;MAAA;MACAD;QACA;MACA;IACA;IACAE;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;IACA;EAAA;AAEA;AAAA,2B;;;;;;;;;;;;;AC3XA;AAAA;AAAA;AAAA;AAAiiD,CAAgB,i6CAAG,EAAC,C;;;;;;;;;;;ACArjD;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pagesB/chat/chat.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pagesB/chat/chat.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chat.vue?vue&type=template&id=7e774f28&\"\nvar renderjs\nimport script from \"./chat.vue?vue&type=script&lang=js&\"\nexport * from \"./chat.vue?vue&type=script&lang=js&\"\nimport style0 from \"./chat.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pagesB/chat/chat.vue\"\nexport default component.exports","export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=template&id=7e774f28&\"","var components\ntry {\n  components = {\n    comheader: function () {\n      return import(\n        /* webpackChunkName: \"components/comheader/comheader\" */ \"@/components/comheader/comheader.vue\"\n      )\n    },\n    tuiModal: function () {\n      return import(\n        /* webpackChunkName: \"components/tui-modal/tui-modal\" */ \"@/components/tui-modal/tui-modal.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var m0 = _vm.formatNumber(_vm.demandData.demandPrice || 0)\n  if (!_vm._isMounted) {\n    _vm.e0 = function ($event) {\n      _vm.changeDemandModal = false\n    }\n  }\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        m0: m0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"chat-page h-100vh flex flex-column bgF7F8FA position-fixed top-0 left-0 right-0 bottom-0\">\r\n\t\t<comheader :title=\"toName\" class=\"flex-shrink\"></comheader>\r\n\t\t<view class=\"bgffff px-2 flex align-center flex-shrink\" style=\"height: 64px;\">\r\n\t\t\t<view class=\"flex flex-column\" style=\"width: 75%;\">\r\n\t\t\t\t<text class=\"ft1D2129 fs-28 text-ellipsis\">{{demandData.title}}</text>\r\n\t\t\t\t<view class=\"flex align-center\">\r\n\t\t\t\t\t<text class=\"ftF53F3F fs-32\">{{formatNumber(demandData.demandPrice || 0)}}元</text>\r\n\t\t\t\t\t<text class=\"ft86909C fs-24\">{{demandData.paymentStatusStr}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view v-if=\"businessStatus == 3\" class=\"fs-24 border rounded px-2  py-1 ml-2\"\r\n\t\t\t\t:class=\"applyOrderDisabled?'ftF85241 bdF85241':'bdFCB6A4 ftFCB6A4'\" @click=\"applyOrder\">\r\n\t\t\t\t{{conversationalistUserRolel == 1?'邀请接单':'申请接单'}}</view>\r\n\t\t\t<view v-if=\"businessStatus == 4\" class=\"fs-24 border rounded px-2  py-1 ml-2 bdFCB6A4 ftFCB6A4\">进行中</view>\r\n\t\t</view>\r\n\t\t<view class=\"flex-1 messageList overflow-y\">\r\n\t\t\t<messageList ref=\"messageList\" \n\t\t\t\t:conversation=\"conversation\" \n\t\t\t\t:sendMsgId=\"sendMsgId\" \n\t\t\t\t:demandId=\"demandId\"\n\t\t\t\t:demandData=\"demandData\"\n\t\t\t\t:currentPersonRole=\"conversationalistUserRolel\"\r\n\t\t\t\t:businessStatus=\"businessStatus\" @changeApplyOrder=\"changeApplyOrder\"\r\n\t\t\t\t@getDemandDatelsFn=\"getDemandDatelsFn\">\r\n\t\t\t</messageList>\r\n\t\t</view>\r\n\t\t<view v-if=\"emojiShow\" class=\"position-fixed top-0 left-0 right-0 bottom-0\" @click.stop=\"handleClose\"></view>\r\n\t\t<view class=\"message-input position-relative z-index1030\">\r\n\t\t\t<message-input ref=\"messageInput\" :conversation=\"conversation\" :demandId=\"demandId\" :sendmsgId=\"sendMsgId\"\r\n\t\t\t\t@sendMessage=\"sendMessage\" @emoji=\"emojiShowFn\" />\r\n\t\t</view>\n\t\t<view :style=\"{height: getSafeAreaBottom + 'px'}\"></view>\r\n\t\t<!--更换需求弹窗-->\r\n\t\t<tui-modal :show=\"changeDemandModal\" custom padding=\"0\">\r\n\t\t\t<view class=\"flex flex-column pt-5\">\r\n\t\t\t\t<view class=\"text-center px-3 font-weight-bolder mb-3\">你已与此需求方沟通过，是否切换新需求继续沟通？</view>\r\n\t\t\t\t<view class=\"flex align-start justify-center fs-32 ft1D2129 p-3\">\r\n\t\t\t\t\t<text style=\"min-width: 100rpx;\" class=\"flex text-ellipsis ft86909C\">新需求:</text>\r\n\t\t\t\t\t<text class=\"ftF85241 text-center text-ellipsis2\">{{newdemandTitle}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"ft86909C text-center mb-4\">注: 更换后将通知需求方</view>\r\n\t\t\t\t<view class=\"flex align-center border-top\" style=\"height: 56px;\">\r\n\t\t\t\t\t<view class=\"flex align-center justify-center ft000000 fs-28 flex-1 h-100\"\r\n\t\t\t\t\t\t@click=\"changeDemandModal = false\">取消</view>\r\n\t\t\t\t\t<view class=\"flex align-center justify-center ftF85241 fs-28 border-left flex-1 h-100\"\r\n\t\t\t\t\t\t@tap=\"replacementRequirementsFn\">切换新需求</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</tui-modal>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tmapGetters,\r\n\t\tmapActions\r\n\t} from 'vuex'\r\n\timport {\r\n\t\tformatNumber\r\n\t} from '@/utils/common.js'\r\n\timport messageInput from '../components/message-input/message-input.vue'\r\n\timport messageList from '../components/message-list/index.vue'\r\n\texport default {\r\n\t\tcomponents: {\r\n\t\t\tmessageInput,\r\n\t\t\tmessageList\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\temojiShow: false, //是否显示表情\r\n\t\t\t\tconversation: {},\r\n\t\t\t\tconversationID: '',\r\n\t\t\t\tsendMsgId: '', //平台发送消息id\r\n\t\t\t\tdemandId: '',\r\n\t\t\t\tuserId: '',\r\n\t\t\t\ttoName: '',\r\n\t\t\t\tdemandData: {},\r\n\t\t\t\tbusinessStatus: 3, // 等待接单中 4 进行中\r\n\t\t\t\tconversationalistUserRolel: 1, //会话人角色（1、发布人，2、承接人）\r\n\t\t\t\tapplyOrderDisabled: false, //申请接单可点\r\n\t\t\t\tchangeDemandModal: false,\r\n\t\t\t\timSingleChatSessionId: null, //平台会话id\r\n\t\t\t\tolddemandRegistrationId: null,\r\n\t\t\t\tnewdemandRegistrationId: null,\r\n\t\t\t\tnewimSingleChatSessionId: null,\r\n\t\t\t\tnewdemandTitle: ''\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t...mapGetters(['isSDKReady','getSafeAreaBottom']),\r\n\t\t},\r\n\t\t/**\r\n\t\t * 生命周期函数--监听页面加载\r\n\t\t */\r\n\t\tonLoad(options) {\r\n\t\t\t// conversationID: C2C、 GROUP\r\n\t\t\t// logger.log(` TUI-chat | onLoad | conversationID: ${options.conversationID}`);\r\n\t\t\tconsole.log(options)\r\n\t\t\tconst {\r\n\t\t\t\tuserID\r\n\t\t\t} = options;\r\n\t\t\tconst olddemandRegistrationId = this.tui.getStorage('olddemandRegistrationId')\r\n\t\t\tconst newdemandRegistrationId = this.tui.getStorage('newdemandRegistrationId')\r\n\t\t\tconst imSingleChatSessionId = this.tui.getStorage('newimSingleChatSessionId')\r\n\t\t\tconst newdemandTitle = this.tui.getStorage('newdemandTitle')\n\t\t\tconsole.log('---------olddemandRegistrationId',olddemandRegistrationId)\n\t\t\tconsole.log('---------newdemandRegistrationId',newdemandRegistrationId)\r\n\t\t\tconsole.log('---------imSingleChatSessionId',imSingleChatSessionId)\r\n\t\t\tif (olddemandRegistrationId && newdemandRegistrationId && imSingleChatSessionId) { //用户判断是否是更换需求\r\n\t\t\t\tthis.olddemandRegistrationId = olddemandRegistrationId\r\n\t\t\t\tthis.newdemandRegistrationId = newdemandRegistrationId\r\n\t\t\t\tthis.newimSingleChatSessionId = imSingleChatSessionId\r\n\t\t\t\tthis.newdemandTitle = newdemandTitle\r\n\t\t\t\tuni.removeStorageSync('olddemandRegistrationId')\r\n\t\t\t\tuni.removeStorageSync('newdemandRegistrationId')\r\n\t\t\t\tuni.removeStorageSync('newimSingleChatSessionId')\r\n\t\t\t\tuni.removeStorageSync('newdemandTitle')\r\n\t\t\t\tthis.changeDemandModal = true\r\n\t\t\t}\r\n\t\t\tthis.conversationID = 'C2C' + userID // 会话ID\r\n\t\t\tthis.userId = userID // 需求ID\r\n\t\t\tthis.conversationID && this.selectByPrimaryKeyFn()\r\n\t\t\tthis.isSDKReady && this.getConversationProfileFn()\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tisSDKReady(val) { // 监听im初始化是否成功 获取会话\r\n\t\t\t\tif (val) {\n\t\t\t\t\tconsole.log('-----------isSDKReady')\r\n\t\t\t\t\tthis.getConversationProfileFn()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\n\t\tdestroyed() {\n\t\t\tclearTimeout(this.interTime)\n\t\t\tthis.interTime = null\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t...mapActions(['getDemandDatels', 'selectByPrimaryKey', 'getIsThereAnyReply', 'requestReceipt',\r\n\t\t\t\t'replacementRequirements', 'invitationToReceiveOrders','sendPayment','queryPayment'\r\n\t\t\t]),\r\n\t\t\tasync getDemandDatelsFn() { // 获取需求详情\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet res = await this.getDemandDatels({\r\n\t\t\t\t\t\tid: this.demandId,\n\t\t\t\t\t\tundertakingUserId:this.userId\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.demandData = res.data\r\n\t\t\t\t\tthis.businessStatus = this.demandData.businessStatus\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tthis.tui.toast(e.msg)\r\n\t\t\t\t\t//TODO handle the exception\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tasync selectByPrimaryKeyFn() { // 用用户id 获取需求id\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet res = await this.selectByPrimaryKey({\r\n\t\t\t\t\t\tuserId: this.userId\r\n\t\t\t\t\t})\r\n\t\t\t\t\tif (res.code == 200) {\r\n\t\t\t\t\t\tthis.conversationalistUserRolel = res.data.conversationalistUserRolel\r\n\t\t\t\t\t\tthis.imSingleChatSessionId = res.data.id\r\n\t\t\t\t\t\tthis.demandId = res.data.demandRegistrationId\r\n\t\t\t\t\t\tthis.sendMsgId = res.data.id\r\n\t\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\t\tthis.$refs.messageList && this.$refs.messageList.getIsThereAnyReplyFn(res.data.id)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tthis.getDemandDatelsFn()\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tthis.tui.toast(e.msg)\r\n\t\t\t\t\tconsole.log(e)\r\n\t\t\t\t\t//TODO handle the exception\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tchangeApplyOrder() { // 申请接单是否可操作\r\n\t\t\t\tthis.applyOrderDisabled = true\r\n\t\t\t},\r\n\t\t\tgetConversationProfileFn() { // 获取会话\r\n\t\t\t\tconsole.log(this.conversationID)\r\n\t\t\t\tuni.$TUIKit\r\n\t\t\t\t\t.setMessageRead({\r\n\t\t\t\t\t\tconversationID: this.conversationID\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then((res) => {\r\n\t\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\t}).catch(err => {\r\n\t\t\t\t\t\tconsole.log(err)\r\n\t\t\t\t\t});\r\n\t\t\t\tconsole.log(this.conversationID)\r\n\t\t\t\tuni.$TUIKit.getConversationProfile(this.conversationID).then(res => {\r\n\t\t\t\t\tconst {\r\n\t\t\t\t\t\tconversation\r\n\t\t\t\t\t} = res.data;\r\n\t\t\t\t\tconsole.log(conversation, '======================')\r\n\t\t\t\t\tthis.toName = conversation.userProfile.nick\r\n\t\t\t\t\tthis.conversation = conversation;\r\n\t\t\t\t\t// this.conversationName = this.getConversationName(conversation)\r\n\t\t\t\t}).catch(err => {\r\n\t\t\t\t\tconsole.log(err)\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tgetConversationName(conversation) { // 获取会话名称\r\n\t\t\t\tif (conversation.type === '@TIM#SYSTEM') {\r\n\t\t\t\t\tthis.setData({\r\n\t\t\t\t\t\tshowChat: false\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn '系统通知';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (conversation.type === 'C2C') {\r\n\t\t\t\t\treturn conversation.remark || conversation.userProfile.nick || conversation.userProfile.userID;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsendMessage(event) {\r\n\t\t\t\t// 将自己发送的消息写进消息列表里面\r\n\t\t\t\tthis.$refs.messageList.updateMessageList(event.detail.message);\r\n\t\t\t},\r\n\t\t\tasync applyOrder() {\r\n\t\t\t\tif (this.conversationalistUserRolel == 1) { // 点击邀请接单\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tif (!this.applyOrderDisabled) {\r\n\t\t\t\t\t\t\tthis.tui.toast('需对方回复后才可以邀请接单')\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet res = await this.invitationToReceiveOrders({\r\n\t\t\t\t\t\t\timSingleChatSessionId: this.imSingleChatSessionId\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tif (res.code == 200) {\r\n\t\t\t\t\t\t\tthis.tui.toast(res.msg)\n\t\t\t\t\t\t\tthis.getDemandDatelsFn()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tconsole.log(e)\n\t\t\t\t\t\tif(e.code == 406){\n\t\t\t\t\t\t\tthis.sendPaymentFn()\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.tui.toast(e.msg)\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//TODO handle the exception\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttry { // 点击申请接单\r\n\t\t\t\t\t\tif (!this.applyOrderDisabled) {\r\n\t\t\t\t\t\t\tthis.tui.toast('需求方回复后才可以申请接单')\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet res = await this.requestReceipt({\r\n\t\t\t\t\t\t\tdemandRegistrationId: this.demandId\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tif (res.code == 200) {\r\n\t\t\t\t\t\t\tthis.tui.toast(res.msg)\n\t\t\t\t\t\t\tthis.getDemandDatelsFn()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tconsole.log(e)\r\n\t\t\t\t\t\tthis.tui.toast(e.msg)\r\n\t\t\t\t\t\t//TODO handle the exception\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t},\n\t\t\tasync sendPaymentFn(){//发起支付\n\t\t\t\ttry{\n\t\t\t\t\tlet res = await this.sendPayment({demandRegistrationId:this.demandId})\n\t\t\t\t\tlet pay = res.data;\n\t\t\t\t\tthis.requestPaymentFn(pay)\n\t\t\t\t}catch(e){\n\t\t\t\t\tif(e.code == 418){\n\t\t\t\t\t\tthis.tui.toast(e.msg)\n\t\t\t\t\t\tthis.paySuccess()\n\t\t\t\t\t}\n\t\t\t\t\t//TODO handle the exception\n\t\t\t\t}\n\t\t\t},\n\t\t\trequestPaymentFn(pay){\n\t\t\t\tconst _this = this\n\t\t\t\tuni.requestPayment({\n\t\t\t\t\tprovider: 'wxpay',    //支付类型-固定值\n\t\t\t\t\ttimeStamp: pay.timeStamp,\n\t\t\t\t\tnonceStr: pay.nonceStr,\n\t\t\t\t\tpackage: pay.packageValue,\n\t\t\t\t\tsignType: pay.signType,\n\t\t\t\t\tpaySign: pay.paySign,\n\t\t\t\t\tsuccess: function (res) {\n\t\t\t\t\t\tconsole.log('success:' + JSON.stringify(res));\n\t\t\t\t\t\tconsole.log(\"支付成功\");\n\t\t\t\t\t\t_this.queryPaymentFn()\n\t\t\t\t\t},\n\t\t\t\t\tfail: function (err) {\n\t\t\t\t\t\tconsole.log('fail:' + JSON.stringify(err));\n\t\t\t\t\t\tconsole.log(\"支付失败\");\n\t\t\t\t\t\tif(err.errMsg.includes('cancel')){\n\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\ticon: 'none',\n\t\t\t\t\t\t\t\ttitle: '取消支付'\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\ticon: 'none',\n\t\t\t\t\t\t\t\ttitle: '支付失败'\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tqueryPaymentFn(){\n\t\t\t\tthis.queryPayment({demandRegistrationId:this.demandId}).then(res => {\n\t\t\t\t\tif(res.code == 200){\n\t\t\t\t\t\tclearTimeout(this.interTime)\n\t\t\t\t\t\tthis.interTime = null\n\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t\t uni.showToast({\n\t\t\t\t\t\t\ticon: 'success',\n\t\t\t\t\t\t\ttitle: '支付成功'\n\t\t\t\t\t\t })\n\t\t\t\t\t\t //再次点击邀请接单\n\t\t\t\t\t\t this.applyOrder()\n\t\t\t\t\t\t this.getDemandDatelsFn()\n\t\t\t\t\t}\n\t\t\t\t}).catch(e => {\n\t\t\t\t\tconsole.log(e)\n\t\t\t\t\tif(e.code == 420){\n\t\t\t\t\t\t uni.showLoading({\n\t\t\t\t\t\t\ttitle:'支付中...'\n\t\t\t\t\t\t })\n\t\t\t\t\t\t clearTimeout(this.interTime)\n\t\t\t\t\t\t this.interTime = setTimeout(() => {\n\t\t\t\t\t\t \tthis.queryPaymentFn()\n\t\t\t\t\t\t },2000)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.tui.toast('支付失败')\t \n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\r\n\t\t\tasync replacementRequirementsFn() { //更换新需求\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet data = {\r\n\t\t\t\t\t\tdemandRegistrationId: this.newdemandRegistrationId,\r\n\t\t\t\t\t\timSingleChatSessionId: this.newimSingleChatSessionId\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet res = await this.replacementRequirements(data)\r\n\t\t\t\t\tif (res.code == 200) {\r\n\t\t\t\t\t\tthis.changeDemandModal = false\r\n\t\t\t\t\t\tthis.tui.toast(res.msg)\r\n\t\t\t\t\t\tthis.selectByPrimaryKeyFn()\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.log(e)\r\n\t\t\t\t\tthis.tui.toast(e.msg)\r\n\t\t\t\t\t//TODO handle the exception\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmescrollInit(mescroll) {\r\n\t\t\t\tthis.mescroll = mescroll;\r\n\t\t\t},\r\n\t\t\tscrollFn(mescroll) {\r\n\t\t\t\tthis.scrollTop = mescroll.scrollTop\r\n\t\t\t},\r\n\t\t\tdownCallback() {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.mescroll.resetUpScroll();\r\n\t\t\t\t}, 600);\r\n\t\t\t},\r\n\t\t\tupCallback(mescroll) { //上拉加载\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.mescroll.endSuccess([], true);\r\n\t\t\t\t}, 600);\r\n\t\t\t},\r\n\t\t\thandleClose() {\r\n\t\t\t\tthis.$refs.messageInput.handleClose()\r\n\t\t\t},\r\n\t\t\temojiShowFn(data) {\r\n\t\t\t\tthis.emojiShow = data\r\n\t\t\t},\r\n\t\t\tformatNumber(price) {\r\n\t\t\t\treturn formatNumber(price)\r\n\t\t\t},\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\t.messageList {\r\n\t\t// max-height: calc(100vh - 44px - 64px - 48px - var(--status-bar-height));\r\n\t}\r\n</style>\n","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1682484349671\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}