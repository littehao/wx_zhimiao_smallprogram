{"version":3,"sources":["webpack:////Users/huhao/Desktop/www/wx_zhimiao/pagesB/components/message-list/index.vue?a426","webpack:////Users/huhao/Desktop/www/wx_zhimiao/pagesB/components/message-list/index.vue?7178","webpack:////Users/huhao/Desktop/www/wx_zhimiao/pagesB/components/message-list/index.vue?413a","webpack:////Users/huhao/Desktop/www/wx_zhimiao/pagesB/components/message-list/index.vue?36c2","uni-app:///pagesB/components/message-list/index.vue","webpack:////Users/huhao/Desktop/www/wx_zhimiao/pagesB/components/message-list/index.vue?f238","webpack:////Users/huhao/Desktop/www/wx_zhimiao/pagesB/components/message-list/index.vue?fda4"],"names":["components","TextMessage","CardMessage","SystemMessage","OrderapplyMessage","FaceMessage","props","conversation","type","default","demandId","sendMsgId","businessStatus","currentPersonRole","demandData","data","isCompleted","enabled","messageList","nextReqMessageID","scrollView","scrollTop","triggered","avatar","userID","applyOrder","interTime","computed","watch","handler","immediate","deep","isSDKReady","mounted","destroyed","clearTimeout","uni","methods","requestPaymentFn","provider","timeStamp","nonceStr","package","signType","paySign","success","console","_this","fail","icon","title","queryPaymentFn","demandRegistrationId","paySuccess","passOrNot","res","sendPaymentFn","pay","receiptApprovalFn","imSingleChatSessionId","state","init","refresh","setTimeout","getMessageList","conversationID","count","then","list","item","$onMessageReadByPeer","setMessageRead","$onMessageReceived","event","$handleMessageRender","getIsThereAnyReplyFn","scrollToButtom","nodesRef","boundingClientRect","exec"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAkH;AAClH;AACyD;AACL;AACc;;;AAGlE;AACmN;AACnN,gBAAgB,iNAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,gFAAM;AACR,EAAE,yFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,oFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAk1B,CAAgB,myBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;AC4Et2B;AAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAMA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;AACA;AAAA,eACA;EACAA;IAAAC;IAAAC;IAAAC;IAAAC;IAAAC;EAAA;EACAC;IACAC;MACAC;MACAC;IACA;IACAC;MACAF;MACAC;IACA;IACAE;MACAH;MACAC;IACA;IACAG;MAAA;MACAJ;IACA;IACAK;MAAA;MACAL;IACA;IACAM;MACAN;MACAC;IACA;EACA;EACAM;IACA;MACAC;MACAC;MAAA;MACA;MACAC;MACAC;MACA;MACAC;MACAC;MACAC;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;IACA;EACA;EACAC,4BACA,iDACA;EACAC;IACArB;MACAsB;QACA;QACA;QACA;MACA;MACAC;MACAC;IACA;IACAC;MAAA;MACA;QACA;MACA;IACA;EACA;EACAC;IACA;EACA;EACAC;IACAC;IACA;IACA;IACAC;EACA;EACAC,yCACA;IACAC;MACA;MACAF;QACAG;QAAA;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;UACAC;UACAA;UACAC;QACA;QACAC;UACAF;UACAA;UACA;YACAV;cACAa;cACAC;YACA;UACA;YACAd;cACAa;cACAC;YACA;UACA;QACA;MACA;IACA;IACAC;MAAA;MACA;QAAAC;MAAA;QACA;UACAjB;UACA;UACAC;UACAA;YACAa;YACAC;UACA;UACA;QACA;MACA;QACAJ;QACA;UACAV;YACAc;UACA;UACAf;UACA;YACA;UACA;QACA;UACA;QACA;MACA;IACA;IACAkB;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA,MAEA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBAAA;gBACAtC;kBACAqC;kBAAA;kBACAE;gBACA;gBAAA;gBAAA,OACA;cAAA;gBAAAC;gBACA;kBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAT;gBACA;kBACA;gBACA;kBACA;gBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACAU;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAEA;kBAAAJ;gBAAA;cAAA;gBAAAG;gBACAE;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEA;kBACA;kBACA;gBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBACA;gBAAA,MACA;kBAAA;kBAAA;gBAAA;gBACA;kBACA;gBACA;kBACAZ;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA,MAGA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBAAA;gBACA/B;kBACA4C;kBAAA;kBACAC;gBACA;gBAAA;gBAAA,OACA;cAAA;gBAAAL;gBACA;kBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAT;gBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAIA;IACAe;MACAzB;MACAA;IACA;IACA0B;MAAA;MACAhB;MACA;QACA,yBACA;QACA;MACA;MACA;MACAiB;QACA;MACA;IACA;IACAC;MAAA;MAAA;MACA;QACA5B,YACA4B;UACAC;UACA9C;UACA+C;QACA,GACAC;UACA;UACArB;UACA;UACA;UACA;UACA;UACAsB;YACA;cACAtB;cACA;gBACA;kBACAuB;gBACA;gBACA;kBAAA;kBACAA;gBACA;gBACA;kBAAA;kBACAA;kBACAA;gBACA;gBACA;kBAAA;kBACAA;gBACA;gBACA;kBAAA;kBACAA;gBACA;cACA;YACA;UACA;UACAvB;UACA;UACA;UACA;QACA;MACA;IACA;IACA;IACAwB;MACAxB;MACA;IACA;IACA;IACAyB;MACAnC;QAAA6B;MAAA;QACAnB;MACA;IACA;IACA;IACA0B;MAAA;MACA;MACA1B;MACA;MACA;MACA;MACA2B;QACA;UACA;YACA;cACA3B;cACA;gBACAuB;cACA;cACA;gBAAA;gBACAA;cACA;cACA;gBAAA;gBACAA;gBACAA;cACA;cACA;gBAAA;gBACAA;cACA;cACA;gBAAA;gBACAA;cACA;YACA;UACA;UACAD;QACA;MACA;MACA;MACA;MACA;IACA;IACA;IACAM;MAAA;MACA;QACA;QACA;UACA;UACA;QACA;MACA;IACA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAEA;kBAAAhB;gBAAA;cAAA;gBAAAJ;gBACA;kBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAIA;IACAqB;MAAA;MAAA;MACA;MACA;MACAC,SACAC;QACA;UACA;UACA;QACA;MACA,GACAC;IACA;EAAA;AAGA;AAAA,2B;;;;;;;;;;;;;ACpbA;AAAA;AAAA;AAAA;AAA6jD,CAAgB,k6CAAG,EAAC,C;;;;;;;;;;;ACAjlD;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pagesB/components/message-list/index.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=68bf58fd&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pagesB/components/message-list/index.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=68bf58fd&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"","<template>\n\t<scroll-view\n\t\tclass=\"message-list-container\"\n\t\tscroll-y=\"true\"\n\t\t:scroll-into-view=\"scrollView\"\n\t\t:refresher-enabled=\"enabled\"\n\t\t@refresherrefresh=\"refresh\"\n\t\t:scroll-top=\"scrollTop\"\n\t\t:refresher-triggered=\"triggered\"\n\t\trefresher-background=\"#F7F8FA\"\n\t\trefresher-default-style=\"none\"\n\t>\n\t\t<template #refresher>\n\t\t\t<view class=\"text-center\" style=\"width:100%\">\n\t\t\t  <tui-loadmore text=\"加载中...\" :index=\"3\" type=\"orange\"></tui-loadmore>\n\t\t\t</view>\n\t\t</template>\n\t\t<view class=\"py-3\" id=\"message-scroll\">\n\t\t\t<view class=\"no-message fs-24 text-center ft86909C\" v-if=\"isCompleted\">~没有更多啦~</view>\n\t\t\t<view v-for=\"(item,index) in messageList\" :key=\"index\" class=\"t-message\">\n\t\t\t\t<view v-if=\"item.type !== '@TIM#SYSTEM'\" :id=\"item.ID\">\n\t\t\t\t\t<view class=\"t-message-item\">\n\t\t\t\t\t\t<view v-if=\"item.type !== 'TIMGroupTipElem'\" :class=\"item.flow === 'out' ? 't-self-message' : 't-recieve-message'\">\n\t\t\t\t\t\t\t<image\n\t\t\t\t\t\t\t\tclass=\"t-message-avatar rounded-circle bgF2F3F5\"\n\t\t\t\t\t\t\t\tv-if=\"item.flow === 'in'\"\n\t\t\t\t\t\t\t\t:src=\"item.avatar || `https://zm.zgzhm.com/mini/img/avatar.png`\"\n\t\t\t\t\t\t\t></image>\n\t\t\t\t\t\t\t<view>\n\t\t\t\t\t\t\t\t<TextMessage \n\t\t\t\t\t\t\t\tv-if=\"item.type === 'TIMTextElem'\" \n\t\t\t\t\t\t\t\t:message=\"item\" \n\t\t\t\t\t\t\t\t:isMine=\"item.flow === 'out'\"\n\t\t\t\t\t\t\t\t:sended=\"item.sended\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t</TextMessage>\n\t\t\t\t\t\t\t\t<CardMessage \n\t\t\t\t\t\t\t\tv-if=\"item.type === 'TIMCustomElem'\" \n\t\t\t\t\t\t\t\t:message=\"item\" \n\t\t\t\t\t\t\t\t:isMine=\"item.flow === 'out'\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t</CardMessage>\n\t\t\t\t\t\t\t\t<FaceMessage \n\t\t\t\t\t\t\t\tv-if=\"item.type === 'TIMFaceElem'\" \n\t\t\t\t\t\t\t\t:message=\"item\" \n\t\t\t\t\t\t\t\t:isMine=\"item.flow === 'out'\">\n\t\t\t\t\t\t\t\t</FaceMessage >\n\t\t\t\t\t\t\t\t<OrderapplyMessage \n\t\t\t\t\t\t\t\tv-if=\"item.type === 'TIMOrderElem'\" \n\t\t\t\t\t\t\t\t:message=\"item\" \n\t\t\t\t\t\t\t\t:demandId=\"demandId\" \n\t\t\t\t\t\t\t\t:demandData=\"demandData\"\n\t\t\t\t\t\t\t\t:isMine=\"item.flow === 'out'\"\n\t\t\t\t\t\t\t\t:businessStatus=\"businessStatus\"\n\t\t\t\t\t\t\t\t@click=\"receiptApprovalFn\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t</OrderapplyMessage>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<image\n\t\t\t\t\t\t\t\tclass=\"t-message-avatar rounded-circle bgF2F3F5\"\n\t\t\t\t\t\t\t\tv-if=\"item.flow === 'out'\"\n\t\t\t\t\t\t\t\t:src=\"(getUser && getUser.wxHeadPortrait) || '/static/images/avatar.png'\"\n\t\t\t\t\t\t\t></image>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view v-else >\n\t\t\t\t\t<SystemMessage :message=\"item\"></SystemMessage>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t</scroll-view>\n</template>\n\n<script>\n\timport { mapGetters,mapActions } from 'vuex'\n\timport TextMessage from '../text-message/index.vue'\n\timport CardMessage from '../card-message/index.vue'\n\timport FaceMessage from '../face-message/index.vue'\n\timport OrderapplyMessage from '../orderapply-message/index.vue'\n\timport SystemMessage from '../system-message/index.vue'\n\tconst dbOperationType = {\n\t\t1:'im消息',\n\t\t2:'需求详情',\n\t\t3:'系统消息',\n\t\t4:'im系统通知',\n\t\t5:'承接人申请接单',\n\t\t6:'发起人邀请接单',\n\t\t7:'发起人收到申请接单',\n\t\t8:'承接人收到邀请接单',\n\t\t9: '承接人完成需求',\n\t\t10: '发起人确认需求',\n\t\t11: '微信公众号推送',\n\t\t12: '更换需求',\n\t\t13: '删除需求'\n\t}\n\texport default {\n\t\tcomponents:{TextMessage,CardMessage,SystemMessage,OrderapplyMessage,FaceMessage},\n\t\tprops:{\n\t\t\tconversation:{\n\t\t\t\ttype:Object,\n\t\t\t\tdefault:{}\n\t\t\t},\n\t\t\tdemandId:{\n\t\t\t\ttype:String,\n\t\t\t\tdefault:''\n\t\t\t},\n\t\t\tsendMsgId:{\n\t\t\t\ttype:String,\n\t\t\t\tdefault:''\n\t\t\t},\n\t\t\tbusinessStatus:{ // 当前需求状态\n\t\t\t\ttype:Number\n\t\t\t},\n\t\t\tcurrentPersonRole:{//1、发起人，2、承接人\n\t\t\t\ttype:Number\n\t\t\t},\n\t\t\tdemandData:{\n\t\t\t\ttype:Object,\n\t\t\t\tdefault:{}\n\t\t\t}\n\t\t},\n\t\tdata(){\n\t\t\treturn {\n\t\t\t\tisCompleted:false,\n\t\t\t\tenabled:true,//允许下拉\n\t\t\t\t// 当前会话\n\t\t\t\tmessageList:[],\n\t\t\t\tnextReqMessageID: '',\n\t\t\t\t// 自己的 ID 用于区分历史消息中，哪部分是自己发出的\n\t\t\t\tscrollView: '',\n\t\t\t\tscrollTop: 0,\n\t\t\t\ttriggered: true,\n\t\t\t\tavatar:'',//我的头像\n\t\t\t\tuserID:'',//我的userID\n\t\t\t\tapplyOrder:false,// 判断是否请求 申请接单\n\t\t\t\tinterTime:null,\n\t\t\t}\n\t\t},\n\t\tcomputed:{\n\t\t\t...mapGetters(['isSDKReady','getUser']),\n\t\t},\n\t\twatch: {\n\t\t\tconversation: {\n\t\t\t\thandler: function(newVal) {\n\t\t\t\t\tif (!newVal.conversationID) return;\n\t\t\t\t\tthis.conversation = newVal\n\t\t\t\t\tthis.getMessageList();\n\t\t\t\t},\n\t\t\t\timmediate: true,\n\t\t\t\tdeep: true\n\t\t\t},\n\t\t\tisSDKReady(val){ // 监听im初始化是否成功 获取会话\n\t\t\t\tif(val){\n\t\t\t\t\tthis.init()\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tmounted() {\n\t\t\tthis.isSDKReady && this.init()\n\t\t},\n\t\tdestroyed() {\n\t\t\tclearTimeout(this.interTime)\n\t\t\tthis.interTime = null\n\t\t\t// 一定要解除相关的事件绑定\n\t\t\tuni.$TUIKit.off(uni.$TUIKitEvent.MESSAGE_RECEIVED, this.$onMessageReceived);\n\t\t},\n\t\tmethods: {\n\t\t\t...mapActions(['getIsThereAnyReply','receiptApproval','declineTheInvitation','sendPayment','queryPayment']),\n\t\t\trequestPaymentFn(pay){\n\t\t\t\tconst _this = this\n\t\t\t\tuni.requestPayment({\n\t\t\t\t\tprovider: 'wxpay',    //支付类型-固定值\n\t\t\t\t\ttimeStamp: pay.timeStamp,\n\t\t\t\t\tnonceStr: pay.nonceStr,\n\t\t\t\t\tpackage: pay.packageValue,\n\t\t\t\t\tsignType: pay.signType,\n\t\t\t\t\tpaySign: pay.paySign,\n\t\t\t\t\tsuccess: function (res) {\n\t\t\t\t\t\tconsole.log('success:' + JSON.stringify(res));\n\t\t\t\t\t\tconsole.log(\"支付成功\");\n\t\t\t\t\t\t_this.queryPaymentFn()\n\t\t\t\t\t},\n\t\t\t\t\tfail: function (err) {\n\t\t\t\t\t\tconsole.log('fail:' + JSON.stringify(err));\n\t\t\t\t\t\tconsole.log(\"支付失败\");\n\t\t\t\t\t\tif(err.errMsg.includes('cancel')){\n\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\ticon: 'none',\n\t\t\t\t\t\t\t\ttitle: '取消支付'\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\ticon: 'none',\n\t\t\t\t\t\t\t\ttitle: '支付失败'\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tqueryPaymentFn(){\n\t\t\t\tthis.queryPayment({demandRegistrationId:this.demandId}).then(res => {\n\t\t\t\t\tif(res.code == 200){\n\t\t\t\t\t\tclearTimeout(this.interTime)\n\t\t\t\t\t\tthis.interTime = null\n\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t\t uni.showToast({\n\t\t\t\t\t\t\ticon: 'success',\n\t\t\t\t\t\t\ttitle: '支付成功'\n\t\t\t\t\t\t })\n\t\t\t\t\t\t this.paySuccess()\n\t\t\t\t\t}\n\t\t\t\t}).catch(e => {\n\t\t\t\t\tconsole.log(e)\n\t\t\t\t\tif(e.code == 420){\n\t\t\t\t\t\t uni.showLoading({\n\t\t\t\t\t\t\ttitle:'支付中...'\n\t\t\t\t\t\t })\n\t\t\t\t\t\t clearTimeout(this.interTime)\n\t\t\t\t\t\t this.interTime = setTimeout(() => {\n\t\t\t\t\t\t \tthis.queryPaymentFn()\n\t\t\t\t\t\t },2000)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.tui.toast('支付失败')\t \n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\tasync paySuccess(){ // 支付成后同意\n\t\t\t\ttry{\n\t\t\t\t\tif(this.businessStatus >= 4 || this.demandData.inviteeStatus == 1 || this.demandData.applicationStatus == 1)return //进行中不能再次点击\n\t\t\t\t\tlet data = {\n\t\t\t\t\t\tdemandRegistrationId:this.demandId,//需求承接Id\n\t\t\t\t\t\tpassOrNot:this.passOrNot//是否通过（0、拒绝，1、通过）\n\t\t\t\t\t}\n\t\t\t\t\tlet res = await this.receiptApproval(data)\n\t\t\t\t\tif(res.code == 200){\n\t\t\t\t\t\tthis.tui.toast(res.msg)\n\t\t\t\t\t\tthis.$emit('getDemandDatelsFn')// 重新获取需求详情 状态\n\t\t\t\t\t}\n\t\t\t\t}catch(e){\n\t\t\t\t\tconsole.log(e)\n\t\t\t\t\tif(e.code == 406){\n\t\t\t\t\t\tthis.sendPaymentFn()\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.tui.toast(e.msg)\n\t\t\t\t\t}\n\t\t\t\t\t//TODO handle the exception\n\t\t\t\t}\n\t\t\t},\n\t\t\tasync sendPaymentFn(){//发起支付\n\t\t\t\ttry{\n\t\t\t\t\tlet res = await this.sendPayment({demandRegistrationId:this.demandId})\n\t\t\t\t\tlet pay = res.data;\n\t\t\t\t\tthis.requestPaymentFn(pay)\n\t\t\t\t}catch(e){\n\t\t\t\t\tif(e.code == 418){\n\t\t\t\t\t\tthis.tui.toast(e.msg)\n\t\t\t\t\t\tthis.paySuccess()\n\t\t\t\t\t}\n\t\t\t\t\t//TODO handle the exception\n\t\t\t\t}\n\t\t\t},\n\t\t\tasync receiptApprovalFn(passOrNot){ // 同意接单 拒绝接单\n\t\t\t\tthis.passOrNot = passOrNot\n\t\t\t\tif(this.currentPersonRole == 1){\n\t\t\t\t\ttry{\n\t\t\t\t\t\tthis.paySuccess()\n\t\t\t\t\t}catch(e){\n\t\t\t\t\t\tconsole.log(e)\n\t\t\t\t\t\t//TODO handle the exception\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttry{\n\t\t\t\t\t\tif(this.businessStatus >= 4 || this.demandData.inviteeStatus == 1 || this.demandData.applicationStatus == 1)return //进行中不能再次点击\n\t\t\t\t\t\tlet data = {\n\t\t\t\t\t\t\timSingleChatSessionId:this.sendMsgId,//需求承接Id\n\t\t\t\t\t\t\tstate:passOrNot//是否通过（0、拒绝，1、通过）\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet res = await this.declineTheInvitation(data)\n\t\t\t\t\t\tif(res.code == 200){\n\t\t\t\t\t\t\tthis.tui.toast(res.msg)\n\t\t\t\t\t\t\tthis.$emit('getDemandDatelsFn')// 重新获取需求详情 状态\n\t\t\t\t\t\t}\n\t\t\t\t\t}catch(e){\n\t\t\t\t\t\tconsole.log(e)\n\t\t\t\t\t\tthis.tui.toast(e.msg)\n\t\t\t\t\t\t//TODO handle the exception\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t},\n\t\t\tinit(){\n\t\t\t\tuni.$TUIKit.on(uni.$TUIKitEvent.MESSAGE_RECEIVED, this.$onMessageReceived, this);\n\t\t\t\tuni.$TUIKit.on(uni.$TUIKitEvent.MESSAGE_READ_BY_PEER, this.$onMessageReadByPeer, this);\n\t\t\t},\n\t\t\trefresh() {\n\t\t\t\tconsole.log(this.isCompleted,this.triggered)\n\t\t\t\tif (this.isCompleted) {\n\t\t\t\t\tthis.isCompleted = true,\n\t\t\t\t\tthis.triggered = false\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.getMessageList();\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.triggered = false\n\t\t\t\t}, 1000);\n\t\t\t},\n\t\t\tgetMessageList() { // 获取消息列表\n\t\t\t\tif (!this.isCompleted) {\n\t\t\t\t\tuni.$TUIKit\n\t\t\t\t\t\t.getMessageList({\n\t\t\t\t\t\t\tconversationID: this.conversation.conversationID,\n\t\t\t\t\t\t\tnextReqMessageID: this.nextReqMessageID,\n\t\t\t\t\t\t\tcount: 20\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(res => {\n\t\t\t\t\t\t\tconst { messageList } = res.data; // 消息列表。\n\t\t\t\t\t\t\tconsole.log(res.data,'消息列表---------------')\n\t\t\t\t\t\t\tthis.nextReqMessageID = res.data.nextReqMessageID; // 用于续拉，分页续拉时需传入该字段。\n\t\t\t\t\t\t\tthis.isCompleted = res.data.isCompleted; // 表示是否已经拉完所有消息。\n\t\t\t\t\t\t\tthis.enabled  = this.isCompleted? false:true\n\t\t\t\t\t\t\tlet list = [...messageList, ...this.messageList]\n\t\t\t\t\t\t\tlist.forEach(item => {\n\t\t\t\t\t\t\t\tif(item.type == \"TIMCustomElem\"){\n\t\t\t\t\t\t\t\t\tconsole.log(item.payload.data)\n\t\t\t\t\t\t\t\t\tif(item.payload.data){\n\t\t\t\t\t\t\t\t\t\tif(typeof  item.payload.data  !=  'object' ){\n\t\t\t\t\t\t\t\t\t\t\titem.payload.data = JSON.parse(item.payload.data)\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif(item.payload.data.dbOperationType == 4){ // 系统通知\n\t\t\t\t\t\t\t\t\t\t\titem.type = '@TIM#SYSTEM'\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif(item.payload.data.dbOperationType == 5 || item.payload.data.dbOperationType == 6){// 5承接人点击申请接单\n\t\t\t\t\t\t\t\t\t\t\titem.type = 'TIMOrderElem'\n\t\t\t\t\t\t\t\t\t\t\titem.flow = 'out'\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif(item.payload.data.dbOperationType == 7  || item.payload.data.dbOperationType == 8){ // 7发起人收到接单申请  \n\t\t\t\t\t\t\t\t\t\t\titem.type = 'TIMOrderElem'\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif(item.payload.data.dbOperationType >= 9){ // 12 更换需求\n\t\t\t\t\t\t\t\t\t\t\titem.type = '@TIM#SYSTEM'\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tconsole.log(list,'消息列表list---------------')\n\t\t\t\t\t\t\tthis.messageList = list;\n\t\t\t\t\t\t\tthis.$handleMessageRender(this.messageList, messageList);\n\t\t\t\t\t\t\t// !this.applyOrder && this.getIsThereAnyReplyFn()\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 消息已读更新\n\t\t\t$onMessageReadByPeer(event) {\n\t\t\t\tconsole.log(event,'已读$onMessageReadByPeer----------')\n\t\t\t\t// this.messageList = this.messageList\n\t\t\t},\n\t\t\t//设置消息已读\n\t\t\tsetMessageRead(){\n\t\t\t\tuni.$TUIKit.setMessageRead({conversationID: this.conversation.conversationID}).then(res => {\n\t\t\t\t\tconsole.log('已读上报成功，指定 ID 的会话的 unreadCount 属性值被置为0')\n\t\t\t\t})\n\t\t\t},\n\t\t\t// 收到的消息\n\t\t\t$onMessageReceived(value) {\n\t\t\t\t// 若需修改消息，需将内存的消息复制一份，不能直接更改消息，防止修复内存消息，导致其他消息监听处发生消息错误\n\t\t\t\tconsole.log(value,'收到的消息')\n\t\t\t\t!this.applyOrder && this.getIsThereAnyReplyFn(this.sendMsgId)// 判断是否回复了消息\n\t\t\t\tconst event = value;\n\t\t\t\tconst list = [];\n\t\t\t\tevent.data.forEach(item => {\n\t\t\t\t\tif (item.conversationID === this.conversation.conversationID) {\n\t\t\t\t\t\tif(item.type == \"TIMCustomElem\"){\n\t\t\t\t\t\t\tif(item.payload.data){\n\t\t\t\t\t\t\t\tconsole.log(typeof  item.payload.data  !=  'object')\n\t\t\t\t\t\t\t\tif(typeof  item.payload.data  !=  'object' ){\n\t\t\t\t\t\t\t\t\titem.payload.data = JSON.parse(item.payload.data)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif(item.payload.data.dbOperationType == 4){ // 系统通知\n\t\t\t\t\t\t\t\t\titem.type = '@TIM#SYSTEM'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif(item.payload.data.dbOperationType == 5 || item.payload.data.dbOperationType == 6){// 5承接人点击申请接单\n\t\t\t\t\t\t\t\t\titem.type = 'TIMOrderElem'\n\t\t\t\t\t\t\t\t\titem.flow = 'out'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif(item.payload.data.dbOperationType == 7 || item.payload.data.dbOperationType == 8){ // 7发起人收到接单申请  \n\t\t\t\t\t\t\t\t\titem.type = 'TIMOrderElem'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif(item.payload.data.dbOperationType >= 9){ // 12 更换需求\n\t\t\t\t\t\t\t\t\titem.type = '@TIM#SYSTEM'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlist.push(Object.assign(item));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.messageList = this.messageList.concat(list);\n\t\t\t\tthis.scrollToButtom();\n\t\t\t\tthis.setMessageRead()\n\t\t\t},\n\t\t\t// 历史消息渲染\n\t\t\t$handleMessageRender(messageList) {\n\t\t\t\tif (messageList.length > 0) {\n\t\t\t\t\tthis.messageList = messageList\n\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\t//进入页面滚动到底部\n\t\t\t\t\t\tthis.scrollTop = 9999;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tasync getIsThereAnyReplyFn(sendMsgId){ // 是否有回复消息\n\t\t\t\ttry{\n\t\t\t\t\tlet res = await this.getIsThereAnyReply({imSingleChatSessionId:sendMsgId})\n\t\t\t\t\tif(res.code == 200){\n\t\t\t\t\t\tthis.$emit('changeApplyOrder',true)\n\t\t\t\t\t\tthis.applyOrder = true\n\t\t\t\t\t}\n\t\t\t\t}catch(e){\n\t\t\t\t\t//TODO handle the exception\n\t\t\t\t}\n\t\t\t},\n\t\t\tscrollToButtom() { //消息至底\n\t\t\t\tconst query = uni.createSelectorQuery().in(this);\n\t\t\t\tlet nodesRef = query.select('#message-scroll');\n\t\t\t\tnodesRef\n\t\t\t\t\t.boundingClientRect(res => {\n\t\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\t\t//进入页面滚动到底部\n\t\t\t\t\t\t\tthis.scrollTop = res.height;\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.exec();\n\t\t\t},\n\t\t\t\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\">\n\t.message-list-container{\n\t\theight: 100%;\n\t\twidth: 100%;\n\t\t.t-message-item {\n\t\t\tpadding: 16rpx 0;\n\t\t}\n\t\t\n\t\t.t-recieve-message {\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: row;\n\t\t\tjustify-items: flex-start;\n\t\t\talign-items: flex-end;\n\t\t\twidth: 100vw;\n\t\t}\n\t\t\n\t\t.t-message-avatar {\n\t\t\tmargin-left: 20rpx;\n\t\t\tmargin-right: 12rpx;\n\t\t\t// border-radius: 10rpx;\n\t\t\twidth: 80rpx;\n\t\t\theight: 80rpx;\n\t\t}\n\t\t\n\t\t.t-self-message {\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: row;\n\t\t\tjustify-content: flex-end;\n\t\t\talign-items: flex-end;\n\t\t\twidth: 100vw;\n\t\t}\n\t\t.read-receipts {\n\t\t\tline-height: 42px;\n\t\t\theight: 42px;\n\t\t\tfont-size: 12px;\n\t\t\tcolor: #6e7981;\n\t\t\tmargin-right: 10px\n\t\t}\n\t}\n</style>","import mod from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1682484349729\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}