{"version":3,"sources":["webpack:////Users/huhao/Desktop/www/wx_zhimiao/components/login/loginBtn.vue?7c94","webpack:////Users/huhao/Desktop/www/wx_zhimiao/components/login/loginBtn.vue?0405","webpack:////Users/huhao/Desktop/www/wx_zhimiao/components/login/loginBtn.vue?7205","webpack:////Users/huhao/Desktop/www/wx_zhimiao/components/login/loginBtn.vue?c8fa","uni-app:///components/login/loginBtn.vue"],"names":["props","ispage","type","default","data","show","code","infoRes","loginCode","checked","methods","checkedFn","getPhoneNumberFn","uni","title","icon","getPhoneNumber","console","loginFn","provider","success","that","fail","getUserProfileFn","content","confirmColor","desc","duration","getTokenFn","res","token","selWxPhoneFn","bindMobileNumberFn","phoneCode","setUserProfileFn","name","wxHeadPortraitUrl","updNameAndPortraitFn","getCurrentLogonInformationFn","delta","getUserSigFn","userID","userSig","navTo","url"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAqH;AACrH;AAC4D;AACL;;;AAGvD;AACgN;AAChN,gBAAgB,iNAAU;AAC1B,EAAE,8EAAM;AACR,EAAE,mFAAM;AACR,EAAE,4FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,uFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,sTAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACjCA;AAAA;AAAA;AAAA;AAAs0B,CAAgB,syBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;ACwB11B;AAAA;AAAA;AAAA,eACA;EACAA;IACAC;MACAC;MACAC;IACA;EACA;EACAC;IACA;MACAC;MACAC;MAAA;MACAC;MACAC;MACAC;IACA;EACA;EACAC,yCACA;IACAC;MACA;IACA;IACAC;MACA;QACAC;UACAC;UACAC;QACA;QACA;MACA;IACA;IACAC;MACAC;MACA;QACA;QACA;MACA;IACA;IACAC;MACA;MACA;MACA;MACAL;QACAM;QACAC;UACAH;UACAI;UACAA;UACA;UACAA;QACA;QACAC;UACAL;QACA;MACA;IACA;IACAM;MAAA;MACA;MACAV;QACAC;QACAU;QACAC;QACAL;UACAH;UACAA;UACA;UACA;YACA;cACAJ;gBACAa;gBACAN;kBACAH;kBACAI;kBACAA;gBACA;gBACAC;kBACAL;kBACAJ;oBACAC;oBACAC;oBACAY;kBACA;gBACA;cACA;YACA;UACA;YACA;YACAd;cACAC;cACAC;cACAY;YACA;YACA;UACA;QACA;MACA;IACA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEAf;kBACAC;gBACA;gBAAA;gBAAA,OACA;kBAAAR;gBAAA;cAAA;gBAAAuB;gBACA;kBACAC;kBACAb;kBACAA;kBACAJ;kBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAA;gBACAI;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACAc;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAEA;cAAA;gBAAAF;gBACA;kBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEA;kBAAA;kBACA;gBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACAG;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAEA;kBAAAC;gBAAA;cAAA;gBAAAJ;gBACA;kBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACAK;MAAA;MACA;MACA;QACAC;QACAC;MACA;MACAf;IACA;IACAgB;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAEA;cAAA;gBAAAR;gBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAIA;IACAS;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAEA;cAAA;gBAAAT;gBACAhB;gBACAI;gBACA;kBACA;kBACA;kBACA;oBACAJ;sBACA0B;oBACA;kBACA;gBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEA1B;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACA2B;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAEA;cAAA;gBAAAX;gBACA;kBACA;kBACAZ;kBACAJ;oBACA4B;oBACAC;kBACA;oBACAzB;oBACA;sBACA;sBACAA;oBACA;kBACA;oBACAA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAIA;IACA0B;MACA9B;QACA+B;MACA;IACA;EAAA;AAEA;AAAA,2B","file":"components/login/loginBtn.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./loginBtn.vue?vue&type=template&id=112338d8&\"\nvar renderjs\nimport script from \"./loginBtn.vue?vue&type=script&lang=js&\"\nexport * from \"./loginBtn.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/login/loginBtn.vue\"\nexport default component.exports","export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./loginBtn.vue?vue&type=template&id=112338d8&\"","var components\ntry {\n  components = {\n    uniIcons: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-icons/components/uni-icons/uni-icons\" */ \"@/uni_modules/uni-icons/components/uni-icons/uni-icons.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./loginBtn.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./loginBtn.vue?vue&type=script&lang=js&\"","<template>\n\t<view class=\"flex flex-column\">\n\t\t<button\n\t\tclass=\"flex align-center justify-center ftffff py-1 rounded-circle bgF85241\" \n\t\tstyle=\"width: 100%;\" \n\t\t:open-type=\"checked?'getPhoneNumber':''\"  \n\t\t@click=\"getPhoneNumberFn\"\n\t\t@getphonenumber=\"getPhoneNumber\">\n\t\t\t<image src=\"/static/images/wx.png\" mode=\"widthFix\" style=\"width: 25px;height: 25px;\"></image>\n\t\t\t<text class=\"fs-32 ml-1\">微信账号快速登录</text>\n\t\t</button>\n\t\t<view class=\"flex align-center justify-center mt-3\">\n\t\t\t<uni-icons :type=\"checked?'checkbox':'circle'\" size=\"20\" :color=\"checked?'#FF4E54':'#999999'\" @click=\"checkedFn\"></uni-icons>\n\t\t\t<text class=\"ft86909C fs-24\">已阅读并同意</text>\n\t\t\t<view class=\"flex align-center justify-center ft86909C fs-24\">\n\t\t\t\t<text class=\"ftF85241 fs-24 text-ellipsis\" @click=\"$debounce(navTo,'1')\">《用户服务协议》</text>\n\t\t\t\t和\n\t\t\t\t<text class=\"ftF85241 fs-24 text-ellipsis\" @click=\"$debounce(navTo,'3')\">《隐私政策》</text>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\timport { mapActions } from 'vuex'\n\texport default{\n\t\tprops:{\n\t\t\tispage:{\n\t\t\t\ttype:Boolean,\n\t\t\t\tdefault:false\n\t\t\t}\n\t\t},\n\t\tdata(){\n\t\t\treturn {\n\t\t\t\tshow:false,\n\t\t\t\tcode:null,//获取手机号code\n\t\t\t\tinfoRes:null,\n\t\t\t\tloginCode:null,\n\t\t\t\tchecked:false\n\t\t\t}\n\t\t},\n\t\tmethods:{\n\t\t\t...mapActions(['authLogin','updNameAndPortrait','getCurrentLogonInformation','getUserSig','selWxPhone','bindMobileNumber']),\n\t\t\tcheckedFn(){\n\t\t\t\tthis.checked = !this.checked\n\t\t\t},\n\t\t\tgetPhoneNumberFn(){\n\t\t\t\tif(!this.checked){\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle:'请阅读并同意用户协议',\n\t\t\t\t\t\ticon:'none'\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t},\n\t\t\tgetPhoneNumber(e){\n\t\t\t\tconsole.log(\"获取手机号码\", e)\n\t\t\t\tif(e.detail.code){\n\t\t\t\t\tthis.code = e.detail.code\n\t\t\t\t\tthis.loginFn()\t\n\t\t\t\t}\n\t\t\t},\n\t\t\tloginFn(){\n\t\t\t\tlet that = this\n\t\t\t\t// this.getCurrentLogonInformationFn()\n\t\t\t\t// return\n\t\t\t\tuni.login({\n\t\t\t\t\tprovider: 'weixin',\n\t\t\t\t\tsuccess: function (res) {\n\t\t\t\t\t  console.log(res);\n\t\t\t\t\t\tthat.loginCode = res.code\n\t\t\t\t\t\tthat.$emit('hide')\n\t\t\t\t\t\t// that.getUserProfileFn()\n\t\t\t\t\t  that.getTokenFn(res.code)\n\t\t\t\t\t},\n\t\t\t\t\tfail:function(err) {\n\t\t\t\t\t\tconsole.log(err)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\tgetUserProfileFn(){  //新用户获取用户信息\n\t\t\t\tlet that = this\n\t\t\t\tuni.showModal({\n\t\t\t\t\ttitle: '温馨提示',\n\t\t\t\t\tcontent: '亲，授权微信登录后才能正常使用小程序功能',\n\t\t\t\t\tconfirmColor:'#F85241',\n\t\t\t\t\tsuccess(res) {\n\t\t\t\t\t\tconsole.log(0)\n\t\t\t\t\t\tconsole.log(res)\n\t\t\t\t\t\t//如果用户点击了确定按钮\n\t\t\t\t\t\tif (res.confirm) {\n\t\t\t\t\t\t\tif(uni.getUserProfile){\n\t\t\t\t\t\t\t\t uni.getUserProfile({\n\t\t\t\t\t\t\t\t   desc: '获取你的昵称、头像、地区及性别',\n\t\t\t\t\t\t\t\t   success: function (infoRes) {\n\t\t\t\t\t\t\t\t\t\tconsole.log('用户昵称为：' + JSON.stringify(infoRes));\n\t\t\t\t\t\t\t\t\t\tthat.infoRes = infoRes\n\t\t\t\t\t\t\t\t\t\tthat.getTokenFn()\n\t\t\t\t\t\t\t\t   },\n\t\t\t\t\t\t\t\t   fail:function(err){\n\t\t\t\t\t\t\t\t\t   console.log(err);\n\t\t\t\t\t\t\t\t\t   uni.showToast({\n\t\t\t\t\t\t\t\t\t   \ttitle: '您拒绝了请求,不能正常使用小程序',\n\t\t\t\t\t\t\t\t\t   \ticon: 'error',\n\t\t\t\t\t\t\t\t\t   \tduration: 2000\n\t\t\t\t\t\t\t\t\t   });\n\t\t\t\t\t\t\t\t   }\n\t\t\t\t\t\t\t\t });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (res.cancel) {\n\t\t\t\t\t\t\t//如果用户点击了取消按钮\n\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\ttitle: '您拒绝了请求,不能正常使用小程序',\n\t\t\t\t\t\t\t\ticon: 'error',\n\t\t\t\t\t\t\t\tduration: 2000\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tasync getTokenFn(){ // 微信小程序获取token\n\t\t\t\ttry{\n\t\t\t\t\tuni.showLoading({\n\t\t\t\t\t\ttitle:'登录中'\n\t\t\t\t\t})\n\t\t\t\t\tlet res = await this.authLogin({code:this.loginCode})\n\t\t\t\t\tif(res.code == 200){\n\t\t\t\t\t\tconst { token } = res.data\n\t\t\t\t\t\tconsole.log(res.data)\n\t\t\t\t\t\tconsole.log(token)\n\t\t\t\t\t\tuni.setStorageSync('zhimiao_token',token)\n\t\t\t\t\t\tthis.$store.commit('setToken',token)\n\t\t\t\t\t\tthis.selWxPhoneFn()//查询用户手机号\n\t\t\t\t\t}\n\t\t\t\t}catch(err){\n\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\tconsole.log(err)\n\t\t\t\t\t//TODO handle the exception\n\t\t\t\t}\n\t\t\t},\n\t\t\tasync selWxPhoneFn(){ // 查询手机号\n\t\t\t\ttry{\n\t\t\t\t\tlet res = await this.selWxPhone()\n\t\t\t\t\tif(res.code == 200){\n\t\t\t\t\t\t// this.setUserProfileFn()\n\t\t\t\t\t\tthis.getCurrentLogonInformationFn()\n\t\t\t\t\t}\n\t\t\t\t}catch(e){\n\t\t\t\t\tif(e.code == 417){ // 未绑定手机号\n\t\t\t\t\t\tthis.bindMobileNumberFn()\n\t\t\t\t\t}\n\t\t\t\t\t//TODO handle the exception\n\t\t\t\t}\n\t\t\t},\n\t\t\tasync bindMobileNumberFn(){ // 绑定手机号\n\t\t\t\ttry{\n\t\t\t\t\tlet res = await this.bindMobileNumber({phoneCode:this.code})\n\t\t\t\t\tif(res.code == 200){\n\t\t\t\t\t\t// this.setUserProfileFn()\n\t\t\t\t\t\tthis.getCurrentLogonInformationFn()\n\t\t\t\t\t}\n\t\t\t\t}catch(e){\n\t\t\t\t\tthis.tui.toast(e.msg)\n\t\t\t\t\t//TODO handle the exception\n\t\t\t\t}\n\t\t\t},\n\t\t\tsetUserProfileFn(){  //新用户设置用户信息\n\t\t\t\tlet that = this\n\t\t\t\tlet data ={\n\t\t\t\t\tname:that.infoRes.userInfo.nickName,\n\t\t\t\t\twxHeadPortraitUrl:that.infoRes.userInfo.avatarUrl || ''\n\t\t\t\t}\n\t\t\t\tthat.updNameAndPortraitFn(data)\n\t\t\t},\n\t\t\tasync updNameAndPortraitFn(data){ // 修改名称和头像\n\t\t\t\ttry{\n\t\t\t\t\tlet res = await this.updNameAndPortrait(data)\n\t\t\t\t\tif(res.code == 200){\n\t\t\t\t\t\tthis.getCurrentLogonInformationFn()\n\t\t\t\t\t}\n\t\t\t\t}catch(e){\n\t\t\t\t\t//TODO handle the exception\n\t\t\t\t}\n\t\t\t},\n\t\t\tasync getCurrentLogonInformationFn(){ // 获取登录用户信息\n\t\t\t\ttry{\n\t\t\t\t\tlet res = await this.getCurrentLogonInformation()\n\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\tconsole.log(res)\n\t\t\t\t\tif(res.code == 200){\n\t\t\t\t\t\tthis.getUserSigFn(res.data.id)\n\t\t\t\t\t\tthis.$store.commit('setUser',res.data)\n\t\t\t\t\t\tif(this.ispage){\n\t\t\t\t\t\t\tuni.navigateBack({\n\t\t\t\t\t\t\t\tdelta:1\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.tui.toast(res.msg)\n\t\t\t\t\t}\n\t\t\t\t}catch(e){\n\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t//TODO handle the exception\n\t\t\t\t}\n\t\t\t},\n\t\t\tasync getUserSigFn(userID){\n\t\t\t\ttry{\n\t\t\t\t\tlet res = await this.getUserSig()\n\t\t\t\t\tif(res.code == 200){\n\t\t\t\t\t\tthis.tui.setStorage('userSig',res.data)\n\t\t\t\t\t\tconsole.log(userID)\n\t\t\t\t\t\tuni.$TUIKit.login({\n\t\t\t\t\t\t\tuserID: userID,\n\t\t\t\t\t\t\tuserSig: res.data\n\t\t\t\t\t\t}).then((imResponse) => {\n\t\t\t\t\t\t\tconsole.log(imResponse.data); // 登录成功\n\t\t\t\t\t\t\t  if (imResponse.data.repeatLogin === true) {\n\t\t\t\t\t\t\t    // 标识账号已登录，本次登录操作为重复登录。v2.5.1 起支持\n\t\t\t\t\t\t\t    console.log(imResponse.data.errorInfo);\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t}).catch((imError) => {\n\t\t\t\t\t\t\tconsole.warn('login error:', imError); // 登录失败的相关信息\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}catch(e){\n\t\t\t\t\t//TODO handle the exception\n\t\t\t\t}\n\t\t\t},\n\t\t\tnavTo(type){\n\t\t\t\tuni.navigateTo({\n\t\t\t\t\turl:'/pagesA/agreement/agreement?type='+type\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\">\n\n</style>"],"sourceRoot":""}